##     å‰è¨€

### å¿…è¯»

è¿™ç¯‡æ–‡ç« æ˜¯è®°å½•æˆ‘ç²—ç•¥å­¦ä¹ 51å•ç‰‡æœºçš„ä¸€äº›ä»£ç ï¼Œæˆ‘ä¼šåŠ äº›ä¸ªäººç†è§£ä»¥åŠæ³¨é‡Šåœ¨é‡Œé¢ã€‚

å› ä¸ºæ˜¯å›«å›µåæ£å¼å­¦ä¹ ï¼Œæ‰€ä»¥è´¨é‡ä¸æ˜¯å¾ˆå¥½ï¼ŒåæœŸæˆ‘ä¼šæ…¢æ…¢ä¼˜åŒ– ğŸ™ˆ

å¦‚æœä½ æƒ³è¦å­¦ä¹ å•ç‰‡æœºï¼Œå¯ä»¥è§‚çœ‹ä¸‹é¢çš„Bç«™æ•™ç¨‹å¹¶é…åˆæœ¬æ–‡æ¡£å­¦ä¹ 

æœ¬æ–‡ç« ä½¿ç”¨çš„51å•ç‰‡æœºæ˜¯ æ™®ä¸­STC89C52RC

[51å•ç‰‡æœºå…¥é—¨æ•™ç¨‹(ä¸‹ç¯‡)(ä»£ç ï¼‹ä¸ªäººç†è§£) â€“ Echo (liveout.cn)](https://www.liveout.cn/51stc89c52code2/)

### æ•™ç¨‹

**æ¨èBç«™è§†é¢‘**ï¼š ã€51å•ç‰‡æœºå…¥é—¨æ•™ç¨‹-2020ç‰ˆ ç¨‹åºå…¨ç¨‹çº¯æ‰‹æ‰“ ä»é›¶å¼€å§‹å…¥é—¨ã€‘ https://www.bilibili.com/video/BV1Mb411e7re/?share_source=copy_web&vd_source=55024add0415795a359bd7b29ca21142(åº”è¯¥éƒ½çŸ¥é“å§)ã€‚

### èµ„æº

**Bç«™æ±Ÿç§‘å¤§èµ„æº**  é“¾æ¥ï¼šhttps://pan.baidu.com/s/1dLED_1VqL66qYItLl5ic4A?pwd=1111    æå–ç ï¼š1111

**æ™®ä¸­**    é“¾æ¥ï¼šhttps://pan.baidu.com/s/1dNCHm9lLMP8pe3rZu3ktZQ?pwd=1111  æå–ç ï¼š1111             

---

## 1. å…¥é—¨

### åŸç†: å•ç‰‡æœºæ ¸å¿ƒ

cpué€šè¿‡é…ç½®å¯„å­˜å™¨æ¥æ§åˆ¶é©±åŠ¨å™¨ï¼Œæ¥æ§åˆ¶ç¡¬ä»¶ç”µè·¯

å¯„å­˜å™¨ï¼šè¿æ¥è½¯ç¡¬ä»¶çš„åª’ä»‹

![å•ç‰‡æœºæ ¸å¿ƒ](https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/%E5%8D%95%E7%89%87%E6%9C%BA%E6%A0%B8%E5%BF%83.png)

### æ•°æ®ç±»å‹

<img src="https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/c51data.png" alt="C51æ•°æ®ç±»å‹" style="zoom: 50%;" />

### 2è¿›åˆ¶----16è¿›åˆ¶è½¬æ¢

<img src="https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/16base.jpg" alt="16base" style="zoom:50%;" />

---

## 2. ç‚¹ç¯

### åŸç†

<img src="https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/LED%E6%A8%A1%E5%9D%97.png" alt="LEDæ¨¡å—" style="zoom: 67%;" />

### 2.1 ç‚¹äº®ç¬¬ä¸€ä¸ªLED

```C
#include <REGX52.H> //å³é”®æ·»åŠ å¤´æ–‡ä»¶
void main()
{   //2è¿›åˆ¶è½¬16è¿›åˆ¶ï¼Œå‰ç¼€ä¸º 0x 87654321 8ä¸ªç¯åºå·å¯¹åº”è¿›åˆ¶
    // 8ä¸ª1åˆ†åˆ«ä¸º8ä¸ªledï¼Œ0åˆ™æ˜¯è´Ÿæç‚¹äº®ã€‚æœ€åä¸€ä¸ª0æ˜¯D1ï¼Œç¬¬ä¸€ä¸ªæ˜¯D8
    P2 = 0xFE; //1111 1110 ç‚¹äº®ç¬¬1ä¸ªled
    P2 = 0x7F; //0111 1111 ç‚¹äº®ç¬¬8ä¸ªled
    P2 = 0x5F; //0101 1111 led 6,8äº®
    P2 = 0xAA; //1010 1010 led 1,3,5,7äº®
    P2 = 0x55; //0101 0101 led 2ï¼Œ4ï¼Œ6ï¼Œ8äº®
	while (1) //ç¨‹åºä¸€ç›´è¿è¡Œ
	{
		
	}
}
```

### 2.2 LEDé—ªçƒ

```C
#include <REGX52.H>
#include <INTRINS.H>
void Delay500ms()		//@11.0592MHz 500mså»¶è¿Ÿå‡½æ•°
{
	unsigned char i, j, k;
    
	_nop_(); //å»æ‰nopä¸ç”¨åŠ å¤´æ–‡ä»¶#include <INTRINS.H>
	i = 4;
	j = 129;
	k = 119;
	do
	{
		do
		{
			while (--k);
		} while (--j);
	} while (--i);
}

void main()
{
	
	while(1)
	{
		P2 = 0xFE; 
		Delay500ms(); //å»¶è¿Ÿ500ms
	    P2 = 0xFF;  
		Delay500ms();
	} 
}
```

### 2.3 LEDæµæ°´ç¯

```C
#include <REGX52.H>

void Delay500ms()		//@11.0592MHz å»¶è¿Ÿ500ms
{
	unsigned char i, j, k;
    
	i = 4;
	j = 129;
	k = 119;
	do
	{
		do
		{
			while (--k);
		} while (--j);
	} while (--i);
}

void main()
{
		while(1)
		{
			P2 = 0xFE; //1111 1110
			Delay500ms();
			P2 = 0xFD; //1111 1101
			Delay500ms();
			P2 = 0xFB; //1111 1011
			Delay500ms();
			P2 = 0xF7; //1111 0111
			Delay500ms();
			P2 = 0xEF; //1110 1111
			Delay500ms();
			P2 = 0xDF; //1101 1111
			Delay500ms();
			P2 = 0xBF; //1011 1111
			Delay500ms();
			P2 = 0x7F; //0111 1111
			Delay500ms();
		}
}
```

### 2.4 LEDæµæ°´ç¯Plus

```C
#include <REGX52.H>
void Delay1ms(unsigned int xms)		//@11.0592MHz
{ //xms ä¸ºå»¶è¿Ÿç§’æ•°
	unsigned char i, j;
  while(xms)
	{
		
		i = 2;
		j = 199;
		do
		{
			while (--j);
		} while (--i);
		xms--;
	}
}

void main()
{
	while(1)
		{
			P2 = 0xFE; //1111 1110
			Delay1ms(500); //å»¶è¿Ÿ500ms
			P2 = 0xFD; //1111 1101
			Delay1ms(100); //100ms
			P2 = 0xFB; //1111 1011
			Delay1ms(1000); //1000ms
			P2 = 0xF7; //1111 0111
			Delay1ms(500);
			P2 = 0xEF; //1110 1111
			Delay1ms(200);
			P2 = 0xDF; //1101 1111
			Delay1ms(500);
			P2 = 0xBF; //1011 1111
			Delay1ms(900);
			P2 = 0x7F; //0111 1111
			Delay1ms(500);
		}
	Delay1ms(500);
}
```

---

## 3.ç‹¬ç«‹æŒ‰é”®æ§åˆ¶LED

### åŸç†ï¼ˆé«˜ç”µå¹³ã€ä½ç”µå¹³ï¼‰

ç”µå¹³å’Œç”µå‹æ˜¯æœ‰å·®åˆ«çš„ï¼Œé«˜ç”µå¹³æŒ‡çš„æ˜¯ä¸ä½ç”µå¹³ç›¸å¯¹çš„é«˜ç”µå‹ï¼Œæ˜¯ç”µå·¥ç¨‹ä¸Šçš„ä¸€ç§è¯´æ³•ã€‚

åœ¨é€»è¾‘ç”µå¹³ä¸­ï¼Œä¿è¯é€»è¾‘é—¨çš„è¾“å…¥ä¸ºé«˜ç”µå¹³æ—¶æ‰€å…è®¸çš„æœ€å°è¾“å…¥é«˜ç”µå¹³ï¼Œå½“è¾“å…¥ç”µå¹³é«˜äºè¾“å…¥é«˜ç”µå‹(Vih)æ—¶ï¼Œåˆ™è®¤ä¸ºè¾“å…¥ç”µå¹³ä¸ºé«˜ç”µå¹³ã€‚

åœ¨ç”µå­å’Œè‡ªåŠ¨åŒ–æ§åˆ¶ä¸­ï¼Œåˆ†ä¸ºæ¨¡æ‹Ÿä¿¡å·å’Œæ•°å­—ä¿¡å·ï¼Œåœ¨æ•°å­—é€»è¾‘ç”µå­ç”µè·¯ä¸­ï¼Œæ•°å­—ä¿¡å·æ˜¯äºŒè¿›åˆ¶çš„ï¼Œå³åªæœ‰0ä¿¡å·å’Œ1ä¿¡å·ã€‚

é«˜ç”µå¹³è¡¨ç¤ºç”µå‹é«˜çš„çŠ¶æ€,è®°ä¸º1ï¼Œä¸€èˆ¬è§„å®šé«˜ç”µå¹³ä¸º3.5~5V
ä½ç”µå¹³è¡¨ç¤ºç”µå‹ä½çš„çŠ¶æ€, è®°ä¸º0ï¼Œä¸€èˆ¬è§„å®šä½ç”µå¹³ä¸º0~0.25V

![ ](https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/%E7%8B%AC%E7%AB%8B%E6%8C%89%E9%94%AE%E6%A8%A1%E5%9D%97.png)

æŒ‰é”®æ¾å¼€  é«˜ç”µå¹³  1  

æŒ‰é”®æŒ‰ä¸‹   ä½ç”µå¹³ 0

### 3.1 ç‹¬ç«‹æŒ‰é”®æ§åˆ¶LEDç¯ç­

```C
#include <REGX52.H>
//P2_0å°±æ˜¯å•ç‰‡æœºä¸Šé¢çš„ä¸€ä¸ªç«¯å£ï¼Œè¿™ä¸ªç«¯å£å°±æ˜¯é“¾æ¥å³è¾¹ç¬¬ä¸€ä¸ªledç¯çš„
//ç­‰äºå·¦è¾¹ä¸ƒä¸ªLEDç›´æ¥ä¸ç»™ä¿¡å·äº†ï¼Œåªç»™å³è¾¹ç¬¬ä¸€ä¸ªä¸€ä¸ªäº®çš„ä¿¡å·
void main()
{
	//P2 = 0xFE;
	P2_0 = 1;
	while(1)
	{ // æŒ‰ä¸‹äº®ï¼Œæ¾å¼€ç­
		if(P3_1==0) //P3_1æ§åˆ¶ç¬¬ä¸€ä¸ªæŒ‰é”®,å³P31
		{
			P2_0 = 0; //P2_0æ˜¯ç¬¬ä¸€ä¸ªLEDï¼Œ0åˆ™äº®
		}
		else
		{
			P2_0=1;
		}
        
        if (P3_0==0)
		{
			P2_1 = 0;
		}
        else
		{
			P2_1 = 1;
		}	
	}
}
```

### 3.2 ç‹¬ç«‹æŒ‰é”®æ§åˆ¶LEDçŠ¶æ€

```C
#include <REGX52.H>
void Delay1ms(unsigned int xms)		//@11.0592MHz
{
	unsigned char i, j;
	while(xms)
	{
			i = 2;
			j = 199;
			do
			{
				while (--j);
			} while (--i);	
			xms--;
	}
}

void main()
{  //æŒ‰ä¸€æ¬¡äº®ï¼Œå†æŒ‰ä¸€æ¬¡ç­
		while(1)
		{
				if(P3_1==0)
				{
					Delay1ms(20); //æŒ‰ä¸‹æ—¶æ¶ˆæŠ–
					while(P3_1==0); //æ¾å¼€è·³å‡ºwhileå¾ªç¯ï¼Œä¸æ¾å¼€ä¸€ç›´å¾ªç¯ï¼Œæ‰€ä»¥ç¯ä¸ä¼šæœ‰ååº”
					Delay1ms(20); //æ¾å¼€æ—¶æ¶ˆæŠ–
					
					P2_0=~P2_0; //å–åï¼Œç­å˜äº®ï¼Œäº®å˜ç­
				}
		}
}

```

### 3.3 ç‹¬ç«‹æŒ‰é”®æ§åˆ¶LEDæ˜¾ç¤ºäºŒè¿›åˆ¶

```C
#include <REGX52.H>
void Delay1ms(unsigned int xms)		//@11.0592MHz
{
	unsigned char i, j;
	while(xms)
	{
			i = 2;
			j = 199;
			do
			{
				while (--j);
			} while (--i);	
			xms--;
	}
}
void main()
{
	  unsigned char LEDNum = 0; 
		while(1)
		{
			if(P3_1==0)
			{
				Delay1ms(20);
				while(P3_1==0)
				Delay1ms(20);
				
				LEDNum++; //0000 0001
				P2 = ~LEDNum; //å–åï¼Œ 1111 1110,ç¬¬ä¸€ä¸ªLEDç¯äº®
			}
		}
}

```

### 3.4 ç‹¬ç«‹æŒ‰é”®æ§åˆ¶LEDç§»ä½

0000 0001 -> 0000 0010 -> 0000 0100 ....

0x01<<0         0x01<<1           0x01<<2 ....

```C
#include <REGX52.H>
void Delay1ms(unsigned int xms)		//@11.0592MHz
{
	unsigned char i, j;
	while(xms)
	{
			i = 2;
			j = 199;
			do
			{
				while (--j);
			} while (--i);	
			xms--;
	}
} 
void main()
{
	unsigned char LEDNum = 0;
	P2 = ~0x01; //LEDåˆå§‹åŒ–ï¼Œä¸ç„¶ç¬¬ä¸€æ¬¡led1ä¸äº®
	while(1)
	{
        //æŒ‰é”®1å³ç§»
		if(P3_1==0) //æŒ‰é”®1æŒ‰ä¸‹
		{
			Delay1ms(20);
			while(P3_1==0);
			Delay1ms(20);
			
			LEDNum++; //å³ç§»
			if (LEDNum>=8)
				LEDNum=0; //é‡ç½®
			
			P2=~(0x01<<LEDNum);
		}
		
        //æŒ‰é”®2å·¦ç§»
		if(P3_0==0) //æŒ‰é”®1æŒ‰ä¸‹
		{
			Delay1ms(20);
			while(P3_0==0);
			Delay1ms(20);
			
			if(LEDNum==0)
				LEDNum=7; //é‡ç½®
			else
				LEDNum--; //å·¦ç§»
			
			P2=~(0x01<<LEDNum);
		}
	}
}


```

---

## 4.æ•°ç ç®¡

LEDæ•°ç ç®¡ï¼šç”±å¤šä¸ªå‘å…‰äºŒæç®¡å°è£…åœ¨ä¸€èµ·ç»„æˆâ€œ8â€å­—å‹

è¾“å‡ºæ‰«æï¼šæ˜¾ç¤ºç¬¬ä¸€ä½->æ˜¾ç¤ºç¬¬äºŒä½->æ˜¾ç¤ºç¬¬ä¸‰ä½......ï¼Œç„¶åå¿«é€Ÿå¾ªç¯è¿™ä¸ªè¿‡ç¨‹ï¼Œæœ€ç»ˆå®ç°æ‰€æœ‰æ•°ç ç®¡åŒæ—¶æ˜¾ç¤ºçš„æ•ˆæœ

### åŸç†

<img src="https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/138%E9%AA%8C%E7%A0%81%E5%99%A8.png" alt="138éªŒç å™¨"  />

```C
//è¿™é‡Œç¯çš„é¡ºåºæ’åˆ—æˆ‘çš„ç†è§£æœ‰é”™è¯¯ï¼Œè¿˜æ²¡ä»”ç»†ç ”ç©¶ã€‚æˆ‘çš„å•ç‰‡æœº111æ—¶æ˜¯Y0,å³LED1äº®
C(P24)  B(P23)    A(P22)  Y		 LED 8 -> 1
0(4)	0ï¼ˆ2ï¼‰	0(1)	Y7		0 1 1 1 1 1 1 1  LED8
0		0		 1   	 Y6		 1 0 1 1 1 1 1 1  LED7
1		0		 1		 Y2		 1 1 1 1 1 0 1 1  LED3
1		1		 1		 Y0		 1 1 1 1 1 1 1 0  LED1    
```



<img src="https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/%E5%8A%A8%E6%80%81%E6%95%B0%E7%A0%81%E7%AE%A1.png" alt="åŠ¨æ€æ•°ç ç®¡"  />

ä¸Šé¢æ˜¯å…±é˜´æï¼Œå…¬å…±ç«¯ä¸º0åˆ™äº®ã€‚å¦‚LED7(å¼•è„š9)ä¸º0ï¼Œå…¶ä»–ä¸º1ã€‚å³ 1011 1111ï¼Œåˆ™LED7äº®ï¼Œå…¶ä»–ä¸äº®ã€‚

ä¸‹é¢æ˜¯é˜´ç ã€‚LEDæ˜¾ç¤º7ï¼Œåˆ™bã€cä¸º1ï¼Œå…¶ä»–0ã€‚å³ 0110 0000

### 4.1 é™æ€æ•°ç ç®¡æ˜¾ç¤º

ç‚¹äº®ä¸€ä¸ª

```C
#include <REGX52.H>

void main()
{
    //100,å³4ï¼ŒLED4äº®
	P2_4 = 1;
	P2_3 = 0;
	P2_2 = 0;
    //P07->P00  0000 0111 ï¼Œå³0x07ï¼Œ
    //aã€bã€cä¸º1ï¼Œå³aã€bã€cäº®ï¼Œæ˜¾ç¤ºä¸º7
	P0 = 0x07;
	while(1)
	{
		
	}
}
```

æ¨¡å—åŒ–

```C
#include <REGX52.H>
//æ˜¾ç¤ºæ•°å­—çš„æ®µç å­˜å‚¨åœ¨æ•°ç»„ä¸­
//0~9 -> 0~9
unsigned char NixieTable[]={0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,
0x7F,0x6F,0x77,0x7C,0x39,0x5E,0x79,0x71,0x00};

void Nixie(unsigned char Location,Number)
{   //Locationä¸ºLEDç¯åºå·ï¼ŒNumberä¸ºæ˜¾ç¤ºæ•°å­—
	switch(Location)
	{
		case 1:P2_4=1;P2_3=1;P2_2=1;break;
		case 2:P2_4=1;P2_3=1;P2_2=0;break;
		case 3:P2_4=1;P2_3=0;P2_2=1;break;
		case 4:P2_4=1;P2_3=0;P2_2=0;break;
		case 5:P2_4=0;P2_3=1;P2_2=1;break;
		case 6:P2_4=0;P2_3=1;P2_2=0;break;
		case 7:P2_4=0;P2_3=0;P2_2=1;break;
		case 8:P2_4=0;P2_3=0;P2_2=0;break;
	}
	P0=NixieTable[Number];
}

void main()
{
	Nixie(6,2); //ç¬¬6ä¸ªLEDæ˜¾ç¤º2
	while(1)
	{
		
	}
}
```

### 4.2 åŠ¨æ€æ•°ç ç®¡æ˜¾ç¤º

ä¸ªäººç†è§£ï¼šå°±åƒæ—©æœŸç”µå½±ä¸€æ ·ï¼Œé€šè¿‡è§†è§‰æ®‹ç•™åŠ¨æ€æ˜¾ç¤ºã€‚å®é™…ä¸Šåªèƒ½æœ‰ä¸€ä¸ªLEDç¯äº®

æ¶ˆå½±ï¼šä½é€‰ æ®µé€‰ æ¸…é›¶ ä½é€‰ æ®µé€‰ æ¸…é›¶

**åˆ©ç”¨å»¶æ—¶æ¥æŠµæ¶ˆäººçš„è§†è§‰æš‚ç•™ç°è±¡è¾¾åˆ°æ¶ˆå½±**

```C
#include <REGX52.H>

void Delay1ms(unsigned int xms)		//@11.0592MHz
{
	unsigned char i, j;
	while(xms)
	{
			i = 2;
			j = 199;
			do
			{
				while (--j);
			} while (--i);	
			xms--;
	}
} 

unsigned char NixieTable[]={0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,
0x7F,0x6F,0x77,0x7C,0x39,0x5E,0x79,0x71,0x00};

void Nixie(unsigned char Location,Number)
{   
	switch(Location)
	{
		case 1:P2_4=1;P2_3=1;P2_2=1;break;
		case 2:P2_4=1;P2_3=1;P2_2=0;break;
		case 3:P2_4=1;P2_3=0;P2_2=1;break;
		case 4:P2_4=1;P2_3=0;P2_2=0;break;
		case 5:P2_4=0;P2_3=1;P2_2=1;break;
		case 6:P2_4=0;P2_3=1;P2_2=0;break;
		case 7:P2_4=0;P2_3=0;P2_2=1;break;
		case 8:P2_4=0;P2_3=0;P2_2=0;break;
	}
	P0=NixieTable[Number]; //æ®µé€‰
	Delay1ms(1); 
	P0=0x00; //æ¸…é›¶
}

void main()
{

	while(1)
	{
			Nixie(1,1); 
			//Delay1ms(500);  //æ­¤å»¶è¿Ÿç”¨äºä»ç¬¬ä¸€ä¸ªled1ä¾æ¬¡æ˜¾ç¤ºæ•°å­—
			Nixie(2,2);
			//Delay1ms(500); 
			Nixie(3,3);
			//Delay1ms(500);
 			Nixie(4,4);
//			Delay1ms(500);
   		Nixie(5,5);
//   		Delay1ms(500);
			Nixie(6,6);
//			Delay1ms(500);
			Nixie(7,7);
//			Delay1ms(500);
			Nixie(8,8);
//			Delay1ms(500);
	}
}
```

---

## 5 .1æ¨¡å—åŒ–ç¼–ç¨‹

### è§†é¢‘

https://www.bilibili.com/video/BV1Mb411e7re?p=13&vd_source=a1234589a3616351986bc6d13bcbd8f8

### ä»£ç 

`å¤´æ–‡ä»¶`

```C
//Delay.h
#ifndef __DELAY_H_
#define __DELAY_H_
void Delay(unsigned int xms)		;
#endif
```

```C
//Nixie.h
#ifndef __NIXIE_H___
#define __NIXIE_H__
void Nixie(unsigned char Location,Number);
#endif
```

 `å‡½æ•°`

```C
//main.c
#include <REGX52.H>
#include "Delay.h"
#include "Nixie.h"
void main()
{
	while(1)
	{
		Nixie(1,1);
		Nixie(2,2);
		Nixie(3,3);
	}
}
```

`å…¶ä»–å‡½æ•°`

```C
//Delay.c
void Delay(unsigned int xms)		//@11.0592MHz
{
	unsigned char i, j;
	while(xms)
	{
			i = 2;
			j = 199;
			do
			{
				while (--j);
			} while (--i);	
			xms--;
	}
} 

```

```C
//Nixe.c
#include <REGX52.H>
#include "Delay.h"

unsigned char NixieTable[]={0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,
0x7F,0x6F,0x77,0x7C,0x39,0x5E,0x79,0x71,0x00};

void Nixie(unsigned char Location,Number)
{   
	switch(Location)
	{
		case 1:P2_4=1;P2_3=1;P2_2=1;break;
		case 2:P2_4=1;P2_3=1;P2_2=0;break;
		case 3:P2_4=1;P2_3=0;P2_2=1;break;
		case 4:P2_4=1;P2_3=0;P2_2=0;break;
		case 5:P2_4=0;P2_3=1;P2_2=1;break;
		case 6:P2_4=0;P2_3=1;P2_2=0;break;
		case 7:P2_4=0;P2_3=0;P2_2=1;break;
		case 8:P2_4=0;P2_3=0;P2_2=0;break;
	}
	P0=NixieTable[Number]; 
	Delay(1); 
	P0=0x00; 
}
```



---

## 5.2 LCD1602è°ƒè¯•å·¥å…·

LCDä¸æ•°ç ç®¡å¼•è„šå†²çª 

 ### åŸç†

![LCD1602æ¥å£](https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/LCD1602.png)

![LCDè°ƒè¯•](https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/LCD%E8%B0%83%E8%AF%95.png)

###  ä»£ç 

è®°å¾—æ·»åŠ ä¹‹å‰å®šä¹‰è¿‡çš„å‡½æ•°å’Œå¤´æ–‡ä»¶

```C
//LCD1602.h  åˆ†åˆ«ä¸ºæ˜¾ç¤ºå„ç§è¿›åˆ¶æ•°ç»„ä»¥åŠå­—ç¬¦
#ifndef __LCD1602_H__
#define __LCD1602_H__
void LCD_Init();
void LCD_ShowChar(unsigned char Line,unsigned char Column,char Char);
void LCD_ShowString(unsigned char Line,unsigned char Column,char *String);
void LCD_ShowNum(unsigned char Line,unsigned char Column,unsigned int Number,unsigned char Length);
void LCD_ShowSignedNum(unsigned char Line,unsigned char Column,int Number,unsigned char Length);
void LCD_ShowHexNum(unsigned char Line,unsigned char Column,unsigned int Number,unsigned char Length);
void LCD_ShowBinNum(unsigned char Line,unsigned char Column,unsigned int Number,unsigned char Length);
#endif
```

```C
#include <REGX52.H>

//å¼•è„šé…ç½®ï¼š
sbit LCD_RS=P2^6;
sbit LCD_RW=P2^5;
sbit LCD_EN=P2^7;
#define LCD_DataPort P0

//å‡½æ•°å®šä¹‰ï¼š
/**
  * @brief  LCD1602å»¶æ—¶å‡½æ•°ï¼Œ12MHzè°ƒç”¨å¯å»¶æ—¶1ms
  * @param  æ— 
  * @retval æ— 
  */
void LCD_Delay()
{
	unsigned char i, j;

	i = 2;
	j = 239;
	do
	{
		while (--j);
	} while (--i);
}

/**
  * @brief  LCD1602å†™å‘½ä»¤
  * @param  Command è¦å†™å…¥çš„å‘½ä»¤
  * @retval æ— 
  */
void LCD_WriteCommand(unsigned char Command)
{
	LCD_RS=0;
	LCD_RW=0;
	LCD_DataPort=Command;
	LCD_EN=1;
	LCD_Delay();
	LCD_EN=0;
	LCD_Delay();
}

/**
  * @brief  LCD1602å†™æ•°æ®
  * @param  Data è¦å†™å…¥çš„æ•°æ®
  * @retval æ— 
  */
void LCD_WriteData(unsigned char Data)
{
	LCD_RS=1;
	LCD_RW=0;
	LCD_DataPort=Data;
	LCD_EN=1;
	LCD_Delay();
	LCD_EN=0;
	LCD_Delay();
}

/**
  * @brief  LCD1602è®¾ç½®å…‰æ ‡ä½ç½®
  * @param  Line è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~2
  * @param  Column åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16
  * @retval æ— 
  */
void LCD_SetCursor(unsigned char Line,unsigned char Column)
{
	if(Line==1)
	{
		LCD_WriteCommand(0x80|(Column-1));
	}
	else if(Line==2)
	{
		LCD_WriteCommand(0x80|(Column-1+0x40));
	}
}

/**
  * @brief  LCD1602åˆå§‹åŒ–å‡½æ•°
  * @param  æ— 
  * @retval æ— 
  */
void LCD_Init()
{
	LCD_WriteCommand(0x38);//å…«ä½æ•°æ®æ¥å£ï¼Œä¸¤è¡Œæ˜¾ç¤ºï¼Œ5*7ç‚¹é˜µ
	LCD_WriteCommand(0x0c);//æ˜¾ç¤ºå¼€ï¼Œå…‰æ ‡å…³ï¼Œé—ªçƒå…³
	LCD_WriteCommand(0x06);//æ•°æ®è¯»å†™æ“ä½œåï¼Œå…‰æ ‡è‡ªåŠ¨åŠ ä¸€ï¼Œç”»é¢ä¸åŠ¨
	LCD_WriteCommand(0x01);//å…‰æ ‡å¤ä½ï¼Œæ¸…å±
}

/**
  * @brief  åœ¨LCD1602æŒ‡å®šä½ç½®ä¸Šæ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦
  * @param  Line è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~2
  * @param  Column åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16
  * @param  Char è¦æ˜¾ç¤ºçš„å­—ç¬¦
  * @retval æ— 
  */
void LCD_ShowChar(unsigned char Line,unsigned char Column,char Char)
{
	LCD_SetCursor(Line,Column);
	LCD_WriteData(Char);
}

/**
  * @brief  åœ¨LCD1602æŒ‡å®šä½ç½®å¼€å§‹æ˜¾ç¤ºæ‰€ç»™å­—ç¬¦ä¸²
  * @param  Line èµ·å§‹è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~2
  * @param  Column èµ·å§‹åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16
  * @param  String è¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²
  * @retval æ— 
  */
void LCD_ShowString(unsigned char Line,unsigned char Column,char *String)
{
	unsigned char i;
	LCD_SetCursor(Line,Column);
	for(i=0;String[i]!='\0';i++)
	{
		LCD_WriteData(String[i]);
	}
}

/**
  * @brief  è¿”å›å€¼=Xçš„Yæ¬¡æ–¹
  */
int LCD_Pow(int X,int Y)
{
	unsigned char i;
	int Result=1;
	for(i=0;i<Y;i++)
	{
		Result*=X;
	}
	return Result;
}

/**
  * @brief  åœ¨LCD1602æŒ‡å®šä½ç½®å¼€å§‹æ˜¾ç¤ºæ‰€ç»™æ•°å­—
  * @param  Line èµ·å§‹è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~2
  * @param  Column èµ·å§‹åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16
  * @param  Number è¦æ˜¾ç¤ºçš„æ•°å­—ï¼ŒèŒƒå›´ï¼š0~65535
  * @param  Length è¦æ˜¾ç¤ºæ•°å­—çš„é•¿åº¦ï¼ŒèŒƒå›´ï¼š1~5
  * @retval æ— 
  */
void LCD_ShowNum(unsigned char Line,unsigned char Column,unsigned int Number,unsigned char Length)
{
	unsigned char i;
	LCD_SetCursor(Line,Column);
	for(i=Length;i>0;i--)
	{
		LCD_WriteData(Number/LCD_Pow(10,i-1)%10+'0');
	}
}

/**
  * @brief  åœ¨LCD1602æŒ‡å®šä½ç½®å¼€å§‹ä»¥æœ‰ç¬¦å·åè¿›åˆ¶æ˜¾ç¤ºæ‰€ç»™æ•°å­—
  * @param  Line èµ·å§‹è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~2
  * @param  Column èµ·å§‹åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16
  * @param  Number è¦æ˜¾ç¤ºçš„æ•°å­—ï¼ŒèŒƒå›´ï¼š-32768~32767
  * @param  Length è¦æ˜¾ç¤ºæ•°å­—çš„é•¿åº¦ï¼ŒèŒƒå›´ï¼š1~5
  * @retval æ— 
  */
void LCD_ShowSignedNum(unsigned char Line,unsigned char Column,int Number,unsigned char Length)
{
	unsigned char i;
	unsigned int Number1;
	LCD_SetCursor(Line,Column);
	if(Number>=0)
	{
		LCD_WriteData('+');
		Number1=Number;
	}
	else
	{
		LCD_WriteData('-');
		Number1=-Number;
	}
	for(i=Length;i>0;i--)
	{
		LCD_WriteData(Number1/LCD_Pow(10,i-1)%10+'0');
	}
}

/**
  * @brief  åœ¨LCD1602æŒ‡å®šä½ç½®å¼€å§‹ä»¥åå…­è¿›åˆ¶æ˜¾ç¤ºæ‰€ç»™æ•°å­—
  * @param  Line èµ·å§‹è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~2
  * @param  Column èµ·å§‹åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16
  * @param  Number è¦æ˜¾ç¤ºçš„æ•°å­—ï¼ŒèŒƒå›´ï¼š0~0xFFFF
  * @param  Length è¦æ˜¾ç¤ºæ•°å­—çš„é•¿åº¦ï¼ŒèŒƒå›´ï¼š1~4
  * @retval æ— 
  */
void LCD_ShowHexNum(unsigned char Line,unsigned char Column,unsigned int Number,unsigned char Length)
{
	unsigned char i,SingleNumber;
	LCD_SetCursor(Line,Column);
	for(i=Length;i>0;i--)
	{
		SingleNumber=Number/LCD_Pow(16,i-1)%16;
		if(SingleNumber<10)
		{
			LCD_WriteData(SingleNumber+'0');
		}
		else
		{
			LCD_WriteData(SingleNumber-10+'A');
		}
	}
}

/**
  * @brief  åœ¨LCD1602æŒ‡å®šä½ç½®å¼€å§‹ä»¥äºŒè¿›åˆ¶æ˜¾ç¤ºæ‰€ç»™æ•°å­—
  * @param  Line èµ·å§‹è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~2
  * @param  Column èµ·å§‹åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16
  * @param  Number è¦æ˜¾ç¤ºçš„æ•°å­—ï¼ŒèŒƒå›´ï¼š0~1111 1111 1111 1111
  * @param  Length è¦æ˜¾ç¤ºæ•°å­—çš„é•¿åº¦ï¼ŒèŒƒå›´ï¼š1~16
  * @retval æ— 
  */
void LCD_ShowBinNum(unsigned char Line,unsigned char Column,unsigned int Number,unsigned char Length)
{
	unsigned char i;
	LCD_SetCursor(Line,Column);
	for(i=Length;i>0;i--)
	{
		LCD_WriteData(Number/LCD_Pow(2,i-1)%2+'0');
	}
}
```



```C
//è¾“å‡ºå›ºå®šå€¼
#include <REGX52.H>
#include "LCD1602.h"
void main()
{
	LCD_Init();
	LCD_ShowChar(1,1,'A');
	LCD_ShowString(1,3,"Hello");
	LCD_ShowNum(1,9,123,3);
	LCD_ShowSignedNum(1,13,-66,2);
	LCD_ShowHexNum(2,1,0xA8,2);
	LCD_ShowBinNum(2,4,0xAA,8);
	while(1)
	{
	}
}
```

```C

//è¾“å‡ºå˜é‡å€¼
#include <REGX52.H>
#include "LCD1602.h"
int Result;
void main()
{
	LCD_Init();
	Result = 1+1;
	LCD_ShowNum(1,1,Result,3);
	while(1)
	{
	}
}
```

```C
//è¾“å‡ºå˜é‡å€¼Plus ä»0å¼€å§‹æ˜¾ç¤ºç§’æ•°
#include <REGX52.H>
#include "LCD1602.h"
#include "Delay.h"
int Result=0;
void main()
{
	LCD_Init();
	
	while(1)
	{
		Result++;
		Delay(1000); //1000ms == 1s
		LCD_ShowNum(1,1,Result,3);
	}
}
```

## 6. çŸ©é˜µé”®ç›˜

è¾“å…¥æ‰«æï¼šè¯»å–ç¬¬ä¸€è¡Œ(åˆ—)->è¯»å–ç¬¬äºŒ(åˆ—)->è¯»å–ç¬¬ä¸‰è¡Œ(åˆ—).....ï¼Œç„¶åå¿«é€Ÿå¾ªç¯è¿™ä¸ªè¿‡ç¨‹ï¼Œæœ€ç»ˆå®ç°æ‰€æœ‰æŒ‰é”®åŒæ—¶æ£€æµ‹çš„æ•ˆæœ

### åŸç†

![çŸ©é˜µæŒ‰é”®](https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/%E7%9F%A9%E9%98%B5%E6%8C%89%E9%94%AE.png)

### 6.1çŸ©é˜µé”®ç›˜

è®°å¾—æ·»åŠ ä¹‹å‰å®šä¹‰è¿‡çš„å‡½æ•°å’Œå¤´æ–‡ä»¶

`å¤´æ–‡ä»¶`

```C
//MatrixKey.h
#ifndef __MATRIXKEY_H_
#define __MATRIXKEY_H_
unsigned char MatrixKey();
#endif

```

`å‡½æ•°`

```C
//main.c
#include <REGX52.H>
#include "Delay.h"
#include "LCD1602.h"
#include "MatrixKey.h"
unsigned char KeyNum;
void main()
{
	LCD_Init();
	LCD_ShowString(1,1,"Hello Echo"); //ç¬¬ä¸€è¡Œæ˜¾ç¤ºå­—ç¬¦ä¸²
	while(1)
	{
		KeyNum=MatrixKey();
		if (KeyNum) //å¦‚ä½•æ²¡æœ‰ifï¼ŒæŒ‰ä¸‹ä¸€ç¬é—´æ˜¾ç¤ºæ•°å­—ï¼Œä½†æ˜¯æ¾æ‰‹ä¼šé‡ç½®ä¸º0
		{
			LCD_ShowNum(2,1,KeyNum,2);//ç¬¬2è¡Œæ˜¾ç¤ºKeyNumï¼Œå³æŒ‰ä¸‹æŒ‰é”®é”®ç å€¼
		}
	}
}                      
```

```C
//MatrixKey.c
#include <REGX52.H>
#include "Delay.h"
//Function Definition:
/**
  * @brief çŸ©é˜µé”®ç›˜è¯»å–æŒ‰é”®ç 
  * @param  æ— 
  * @retval KeyNumber æŒ‰ä¸‹æŒ‰é”®çš„é”®ç å€¼
  å¦‚æœæŒ‰é”®æŒ‰ä¸‹ä¸æ”¾ï¼Œç¨‹åºä¼šåœç•™åœ¨æ­¤å‡½æ•°ï¼Œæ¾æ‰‹ä¸€ç¬é—´ï¼Œè¿”å›æŒ‰é”®é”®ç ã€‚æ²¡æœ‰æŒ‰é”®æŒ‰ä¸‹æ—¶è¿”å›0
  */

unsigned char MatrixKey()
{
	unsigned char KeyNumber=0;
	P1 = 0xFF; //åˆå§‹åŒ–
	P1_3=0;  //ç¬¬1åˆ—
	if(P1_7==0) {Delay(20);while(P1_7==0);Delay(20);KeyNumber=1;}//ç¬¬1è¡Œ
	if(P1_6==0) {Delay(20);while(P1_6==0);Delay(20);KeyNumber=5;}//ç¬¬2è¡Œ
	if(P1_5==0) {Delay(20);while(P1_5==0);Delay(20);KeyNumber=9;}//ç¬¬3è¡Œ
	if(P1_4==0) {Delay(20);while(P1_4==0);Delay(20);KeyNumber=13;}//ç¬¬4è¡Œ
	
	P1 = 0xFF;
	P1_2=0;  //ç¬¬2åˆ—
	if(P1_7==0) {Delay(20);while(P1_7==0);Delay(20);KeyNumber=2;}
	if(P1_6==0) {Delay(20);while(P1_6==0);Delay(20);KeyNumber=6;}
	if(P1_5==0) {Delay(20);while(P1_5==0);Delay(20);KeyNumber=10;}
	if(P1_4==0) {Delay(20);while(P1_4==0);Delay(20);KeyNumber=14;}
	
	P1 = 0xFF;
	P1_1=0;  //ç¬¬3åˆ—
	if(P1_7==0) {Delay(20);while(P1_7==0);Delay(20);KeyNumber=3;}
	if(P1_6==0) {Delay(20);while(P1_6==0);Delay(20);KeyNumber=7;}
	if(P1_5==0) {Delay(20);while(P1_5==0);Delay(20);KeyNumber=11;}
	if(P1_4==0) {Delay(20);while(P1_4==0);Delay(20);KeyNumber=15;}
	
	P1 = 0xFF;
	P1_0=0;  //ç¬¬4åˆ—
	if(P1_7==0) {Delay(20);while(P1_7==0);Delay(20);KeyNumber=4;}
	if(P1_6==0) {Delay(20);while(P1_6==0);Delay(20);KeyNumber=8;}
	if(P1_5==0) {Delay(20);while(P1_5==0);Delay(20);KeyNumber=12;}
	if(P1_4==0) {Delay(20);while(P1_4==0);Delay(20);KeyNumber=16;}
	
	return KeyNumber; //è¿”å›æŒ‰ä¸‹æŒ‰é”®é”®ç å€¼
}                    
```

### 6.2 å¯†ç é”

```C
#include <REGX52.H>
#include "Delay.h"
#include "LCD1602.h"
#include "MatrixKey.h"

//unsigned charæ²¡æœ‰ç¬¦å·ä½ï¼Œå› æ­¤èƒ½è¡¨ç¤º0~255ï¼Œä½†æ˜¯å¯†ç è‚¯å®šä¸èƒ½è¿™ä¹ˆçŸ­ã€‚
//Bç«™è§†é¢‘æ•™ç¨‹æ˜¯unsigned charç±»å‹ï¼Œä½†æ˜¯æˆ‘è¾“å…¥æ—¶åªèƒ½åˆ°256ï¼Œæ”¹ä¸ºintç±»å‹å°±è¡Œäº†
int KeyNum;
int Password,Count;

void main()
{
	LCD_Init();
	LCD_ShowString(1,1,"PassWord");
	while(1)
	{
		KeyNum=MatrixKey();
		if (KeyNum)
		{
			if(KeyNum<=10) //å¦‚æœS1~S2æŒ‰é”®æŒ‰ä¸‹ï¼Œè¾“å…¥å¯†ç 
            {
                 if(Count<4)
				Password*=10; //å¯†ç å·¦ç§»ä¸€ä½
				Password+=KeyNum%10; //è·å–ä¸€ä½å¯†ç 
            }
             Count++; ã€‚//è®¡æ¬¡åŠ ä¸€
			LCD_ShowNum(2,1,Password,4); //æ›´æ–°æ˜¾ç¤º
		}
        if(KeyNum==11)   //æŒ‰ä¸‹S11æŒ‰é”®ç¡®è®¤
		{
			if (Password==2345) //å¯†ç æ­£ç¡®
			{
				LCD_ShowString(1,12,"OK"); //æ˜¾ç¤ºOK
                  Password=0; //å¯†ç æ¸…ç†
				Count=0;  //è®¡æ•°æ¸…ç†
                  LCD_ShowNum(2,1,Password,4); //æ›´æ–°æ˜¾ç¤º
			}
            else
            {
                 LCD_ShowString(1,12,"ERROR");
				//Delay(2000); //å»¶æ—¶2sï¼Œç„¶åç©ºæ ¼æ›¿ä»£ï¼Œä¸ç„¶OKåé¢ä¼šæ˜¾ç¤ºROR
				Password=0;
				Count=0;
				LCD_ShowNum(2,1,Password,4);
				//LCD_ShowString(1,12,"     "); //ç©ºæ ¼æ›¿ä»£
            }
		}
        if (KeyNum==12) //æŒ‰é”®S12æ‰‹åŠ¨æ¸…é›¶
		{
		   		Password=0; //å¯†ç æ¸…é›¶
				Count=0;   //è®¡æ¬¡æ¸…é›¶
            	 LCD_ShowString(1,12,"     "); //ç©ºæ ¼æ›¿ä»£
				LCD_ShowNum(2,1,Password,4); //æ›´æ–°æ˜¾ç¤º
                  
		}
	}
}                      
```

---

## 7. å®šæ—¶å™¨

### åŸç†

è¿™ç« æ¯”è¾ƒéš¾ï¼Œå¾—å¤šçœ‹å‡ éè§†é¢‘ 

è§†é¢‘æ•™ç¨‹ï¼šhttps://www.bilibili.com/video/BV1Mb411e7re/?p=17&spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=a1234589a3616351986bc6d13bcbd8f8

---

å®šæ—¶å™¨ä¸ªæ•°ï¼š3ä¸ª(T0ã€T1ã€T2)ï¼ŒT0å’ŒT1ä¸ä¼ ç»Ÿçš„51å•ç‰‡æœºå…¼å®¹ï¼ŒT2æ˜¯æ­¤å‹å·å•ç‰‡æœºå¢åŠ çš„èµ„æº

SySclkï¼šç³»ç»Ÿæ—¶é’Ÿï¼Œå³æ™¶æŒ¯å‘¨æœŸï¼Œæœ¬å¼€å‘æ¿ä¸Šçš„æ™¶æŒ¯ä¸º11.0592MHz

æ—¶é’Ÿï¼šç»™0å®šæ—¶å™¨ï¼Œç»™1è®¡æ•°å™¨

---

`åŸºç¡€ç†è§£ä»£ç `ï¼šå®ç°led1ç¯æ¯1sé—ªçƒä¸€æ¬¡

0~65535   æ¯éš”1usè®¡æ•°åŠ ä¸€            æ€»å…±å®šæ—¶æ—¶é—´65535us

ç»™åˆå€¼6435    ç¦»è®¡æ•°å™¨65535 å·®1000us   æ‰€ä»¥è®¡æ•°æ—¶é—´ä¸º1ms

```C
#include <REGX52.H>

//å®šæ—¶å™¨0åˆå§‹åŒ–
void Timer0_Init() //è¿™ä¸ªå‡½æ•°å¯ä»¥é€šè¿‡è½¯ä»¶ç›´æ¥ç”Ÿæˆçš„ï¼ï¼ï¼ï¼Œä½†æ˜¯æ²¡æœ‰ä¸­æ–­ï¼Œå³æœ€åä¸‰ä¸ª
{
    //å®šæ—¶å™¨
	//TMOD=0x01; //0000 0001  é«˜å››ä½  ä½å››ä½
    TMOD=TMOD&0xF0; //æŠŠTMODçš„ä½å››ä½æ¸…0ï¼Œé«˜å››ä½ä¿æŒä¸å˜
    TMOD=TMOD|0x01; //æŠŠTMODçš„æœ€ä½ä½ ç½®ä¸º1ï¼Œé«˜å››ä½ä¿æŒä¸å˜
	TF0=0; //TF0æ˜¯è¿›å…¥ä¸­æ–­ç¨‹åºåï¼Œç¡¬ä»¶è‡ªåŠ¨æ¸…é›¶
	TR0=1; //å®šæ—¶å™¨ä»0å¼€å§‹è®¡æ—¶
    
    //TH0,TL0ä¸ºäºŒè¿›åˆ¶8ä½ï¼Œå•ç‹¬å¯è®¡256æ¬¡   ä½8ä½è®¡æ»¡256åé«˜8ä½è¿›1
    //è®¾ç½®å®šæ—¶åˆå€¼
	TH0=64535/256; //é«˜8ä½æ¬¡æ•° 
	TL0=64535%256; //ä½8ä½æ¬¡æ•°
    
    //ä¸­æ–­
    ET0=1;
    EA=1;
    PT0=0; //è®¾ç½®ä¼˜å…ˆçº§
}

//ä¸»ç¨‹åº
void main()
{
	Timer0_Init();
	while(1)
	{
		
	}
}

//ä¸­æ–­æœåŠ¡ç¨‹åºB
unsigned int T0Count;
void Timer0_Routine() interrupt 1
{
	TH0=64535/256;
	TL0=64535%256; //é‡æ–°èµ‹å€¼
	T0Count++; //æ¯æ¬¡åŠ 1us,1000æ¬¡å°±æ˜¯1s
	if (T0Count>=1000)
	{
		  T0Count=0; //é‡æ–°èµ‹å€¼
		  P2_0=~P2_0; //æ¯1sé—ªçƒä¸€æ¬¡
	}

}
```

###  7.1 æŒ‰é”®æ§åˆ¶LEDæµæ°´ç¯æ¨¡å¼

`å¤´æ–‡ä»¶`

```C
//Delay.h
#ifndef __DELAY_H_
#define __DELAY_H_
void Delay(unsigned int xms);
#endif
```

```C
//Key.h
#ifndef __KEY_H_
#define __KEY_H_
usigned char Key();
#endif

```

```C
//Timer0.h
#ifndef __TIMER0_H_
#define __TIMER0_H_

void Timer0_Init();

#endif

```

`å‡½æ•°`

```C
//Delay.c
//Function Definition
/**
  * @brief å»¶è¿Ÿå‡½æ•°
  * @param  æ— 
  * @retval 1ms
  */
void Delay(unsigned int xms)		//@11.0592MHz
{
	unsigned char i, j;
	while(xms)
	{
			i = 2;
			j = 199;
			do
			{
				while (--j);
			} while (--i);	
			xms--;
	}
} 
	
```

```C
//Key.c
#include <REGX52.H>
#include "Delay.h"

//Function Definition
/**
  * @brief è·å–ç‹¬ç«‹æŒ‰é”®é”®ç 
  * @param  æ— 
  * @retval æŒ‰ä¸‹æŒ‰é”®çš„é”®ç ï¼ŒèŒƒå›´0~4ï¼Œæ— æŒ‰é”®æŒ‰ä¸‹çš„è¿”å›å€¼ä¸º0
  */

unsigned char Key()
{
	unsigned char KeyNum=0;
	
	if(P2_1==0) {Delay(20);while(P2_1==0);Delay(20);KeyNum=1;}
	if(P2_0==0) {Delay(20);while(P2_0==0);Delay(20);KeyNum=2;}
	if(P2_3==0) {Delay(20);while(P2_3==0);Delay(20);KeyNum=3;}
	if(P2_4==0) {Delay(20);while(P2_4==0);Delay(20);KeyNum=4;}
	
	return KeyNum;
}
```

```C
//Timer0.c
#include <REGX52.H>

//Function Definition
/**
  * @brief å®šæ—¶å™¨0åˆå§‹åŒ–
  * @param  æ— 
  * @retval 1ms
  */
void Timer0_Init()	//1æ¯«ç§’@12.000MHz	
{
	TMOD &= 0xF0;	//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼	
	TMOD |= 0x01;	//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼	
	TL0 = 0x66;		//è®¾ç½®å®šæ—¶åˆå€¼
	TH0 = 0xFC;		//è®¾ç½®å®šæ—¶åˆå€¼
	TF0 = 0;        //æ¸…é™¤TF0æ ‡å¿— 
	TR0 = 1;		//å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
	
	ET0=1;
	EA=1;
	PT0=0;
}

```

```C
//mian.c (æµ‹è¯•) æŒ‰é”®æ§åˆ¶ç¯äº®
#include <REGX52.H>
#include "Timer0.h"
#include "Key.h"

unsigned char KeyNum;

void main()
{
    Timer0_Init(); //å®šæ—¶å™¨0åˆå§‹åŒ–
	while(1)
	{
		KeyNum=Key();
		if (KeyNum)
		{
			if(KeyNum==1) P2_0=~P2_0; //æŒ‰K1ï¼Œled1äº®ï¼Œå†æŒ‰ä¸€æ¬¡åˆ™ç†„ç­
			if(KeyNum==2) P2_1=~P2_1;
			if(KeyNum==3) P2_2=~P2_2;
			if(KeyNum==4) P2_3=~P2_3;
		}
	}
}
```

```C
//main.c  æµæ°´ç¯ï¼ŒæŒ‰ä¸‹K1æ”¹å˜æ–¹å‘
#include <REGX52.H>
#include "Timer0.h"
#include "Key.h"
#include "INTRINS.H"

unsigned char KeyNum,LEDMode;

void main()
{
	P2=0xFE;
    Timer0_Init(); //å®šæ—¶å™¨0åˆå§‹åŒ–
	while(1)
	{
		KeyNum=Key();
		if (KeyNum)
		{
			if(KeyNum==1) //æŒ‰ä¸‹K1ï¼Œæ”¹å˜æ–¹å‘
			{
				LEDMode++;
				if(LEDMode>=2) LEDMode=0;
			}
			
		}
	}
}

void Timer0_Routine() interrupt 1
{
    static unsigned int T0Count;
	TL0 = 0x18; //é‡æ–°èµ‹å€¼1us
	TH0 = 0xFC;
	T0Count++;
	if (T0Count>=500) //0.5s
	{
		  T0Count=0;
		  if(LEDMode==0)
			  P2=_crol_(P2,1);  //å‘å·¦ç§»ä½ï¼Œå¹¶ä¸”å¾ªç¯
		  if(LEDMode==1)
			  P2=_cror_(P2,1);  //å‘å³ç§»ä½ï¼Œå¹¶ä¸”å¾ªç¯
	}
}
```

### 7.2 å®šæ—¶å™¨æ—¶é’Ÿ

å¤´æ–‡ä»¶ä¹‹å‰éƒ½å®šä¹‰è¿‡äº†

```C
#include <REGX52.H>
#include "Delay.h"
#include "LCD1602.h"
#include "Timer0.h"

unsigned char Sec,Min,Hou;

void main()
{
	LCD_Init();
	Timer0_Init();
	
	LCD_ShowString(1,1,"Clock:");
	LCD_ShowString(2,1,"  :  :");
	
	while(1)
	{
        //LCDæ˜¾ç¤º
		LCD_ShowNum(2,1,Hour,2);
		LCD_ShowNum(2,4,Min,2);
		LCD_ShowNum(2,7,Sec,2);
	}
}

void Timer0_Routine() interrupt 1
{
    static unsigned int T0Count;
	TL0 = 0x18; //é‡æ–°èµ‹å€¼1us
	TH0 = 0xFC;
	T0Count++;
	if (T0Count>=1000) //1s
	{
	    T0Count=0;
		Sec++;  //æ¯ç§’é€’å¢
		if(Sec>=60)
		{
			Sec=0;
			Min++;
			if(Min>=60)
			{
				Min=0;
				Hour++;
				if(Hour>=24)
				{
					Hour=0;
				}
			}
		}
	}
}
```

---

## 8. ä¸²å£

ä¸²å£æ˜¯ä¸€ç§åº”ç”¨ååˆ†å¹¿æ³›çš„é€šè®¯æ¥å£ï¼Œæˆæœ¬ä½ï¼Œå®¹æ˜“ä½¿ç”¨ï¼Œé€šè®¯çº¿è·¯ç®€å•ï¼Œå¯ä»¥å®ç°ä¸¤ä¸ªè®¾å¤‡çš„äº’é€šæ€§ã€‚

51å•ç‰‡æœºå†…éƒ¨è‡ªå¸¦UART(é€šç”¨å¼‚æ­¥æ”¶å‘å™¨)ï¼Œå¯å®ç°å•ç‰‡æœºçš„ä¸²å£é€šä¿¡ã€‚ä¸²å£æ¥å£æ˜¯DB9æ¥å£

STC89C52æœ‰ä¸€ä¸ªUARTï¼ŒSTC89C52URATæœ‰å››ç§å·¥ä½œæ¨¡å¼

### åŸç†

![USBTTl](https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/USBTTL.png)

![ä¸²å£å¯„å­˜å™¨](https://yy.liveout.cn/article/Learn/cmicrocpu/22_12/%E4%B8%B2%E5%8F%A3%E5%AF%84%E5%AD%98%E5%99%A8.png)

### æ•°æ®æ˜¾ç¤ºæ¨¡å¼

HEXæ¨¡å¼/åå…­è¿›åˆ¶æ¨¡å¼/äºŒè¿›åˆ¶æ¨¡å¼ï¼šä»¥åŸå§‹æ•°æ®çš„å½¢å¼æ˜¾ç¤º

æ–‡æœ¬æ¨¡å¼/å­—ç¬¦æ¨¡å¼ï¼šä»¥åŸå§‹æ•°æ®ç¼–ç åçš„å½¢å¼æ˜¾ç¤º

### 8.1 ä¸²å£å‘ç”µè„‘å‘é€æ•°æ®

`å¤´æ–‡ä»¶`

```C
//UART.h
#ifndef __UART_H_
#define __UART_H_
void UART_Init(); //åˆå§‹åŒ–
void UART_SendByte(unsigned char Byte);//åªå‘é€ï¼Œä¸æ¥æ”¶	
#endif

```

`å‡½æ•°`

```C
//UART.c
#include <REGX52.H>
//Function Definition
/**
  * @brief ä¸²å£åˆå§‹åŒ– 4800bps@11.0592MHz
  * @param  æ— 
  * @retval æ— 
  */

void UART_Init()  //åˆå§‹åŒ– 4800bps@11.0592MHz
{
	SCON = 0x40; //0100 0000
	PCON |= 0x80; 
	
	TMOD &= 0x0F;	//è®¾ç½®å®šæ—¶å™¨1æ¨¡å¼  0000 1111
	TMOD |= 0x20;	//è®¾ç½®å®šæ—¶å™¨1æ¨¡å¼  0010 0000
	TL1 = 0xF4;		//è®¾å®šå®šæ—¶åˆå€¼
	TH1 = 0xF4;		//è®¾å®šå®šæ—¶å™¨é‡è£…å€¼
	ET1 = 0;		//ç¦æ­¢å®šæ—¶å™¨1ä¸­æ–­
	TR1 = 1;		//å¯åŠ¨å®šæ—¶å™¨1

}

//Function Definition
/**
  * @brief ä¸²å£å‘é€ä¸€ä¸ªå­—èŠ‚æ•°æ®
  * @param  Byte è¦å‘é€ä¸€ä¸ªå­—èŠ‚æ•°å­—
  * @retval æ— 
  */

void UART_SendByte(unsigned char Byte) //åªå‘é€ï¼Œä¸æ¥æ”¶ 
{
	SBUF = Byte;
  while(TI==0); //å‘é€æˆåŠŸè·³å‡ºå¾ªç¯ï¼ŒTIå˜ä¸º1
	TI = 0;    //é‡ç½®ä¸º0
}

//ä¸²å£ä¸­æ–­å‡½æ•°æ¨¡æ¿ï¼ˆç”¨åœ¨ä¸‹ä¸€ä¸ªä¾‹å­ä¸­ï¼‰
//void UART_Routine() interrupt 4 //ä¸²å£ä¸­æ–­å·ä¸º4
//{ //RIï¼šæ¥æ”¶ä¸­æ–­è¯·æ±‚æ ‡å¿—ä½ 
//	if(RI==1) //RI=1å‘ä¸»æœºè¯·æ±‚ä¸­æ–­å“
//	{
//		RI=0;//åº”ä¸­æ–­åå¿…é¡»ç”¨è½¯ä»¶å¤ä½ï¼Œå³RI=0  
//	}
//}
```

```C
//main.c
//æ¯ä¸€ç§’å‘é€ä¸€ä¸ªå­—èŠ‚
#include <REGX52.H>
#include "Delay.h"
#include "UART.h"

unsigned char Sec;

void main()
{
	UART_Init(); //åˆå§‹åŒ–
	
	while(1)
	{
		UART_SendByte(Sec); //å‘é€ 16è¿›åˆ¶æ ¼å¼
		Sec++;
		Delay(1000);
	}
}
```

### 8.2 ç”µè„‘é€šè¿‡ä¸²å£æ§åˆ¶LED

```C
#include <REGX52.H>
#include "Delay.h"
#include "UART.h"

void main()
{
	UART_Init();
	
	while(1)
	{
		
	}
}

void UART_Routine() interrupt 4 //ä¸²å£ä¸­æ–­å·ä¸º4
{ //RIï¼šæ¥æ”¶ä¸­æ–­è¯·æ±‚æ ‡å¿—ä½ 
	if(RI==1) //RI=1å‘ä¸»æœºè¯·æ±‚ä¸­æ–­å“
	{
		P2=~SBUF; 
		UART_SendByte(SBUF);
		RI=0;//åº”ä¸­æ–­åå¿…é¡»ç”¨è½¯ä»¶å¤ä½ï¼Œå³RI=0  
	}
}
```

---

ä¸Šç¯‡å·²å®Œç»“ï¼Œå°†ä¼šæŒç»­ä¼˜åŒ–

ä¸‹ç¯‡é“¾æ¥ï¼š[51å•ç‰‡æœºå…¥é—¨æ•™ç¨‹(ä¸‹ç¯‡)(ä»£ç ï¼‹ä¸ªäººç†è§£) â€“ Echo (liveout.cn)](https://www.liveout.cn/51stc89c52code2/)